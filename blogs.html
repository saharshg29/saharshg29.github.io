---
layout: default
---

<div class="controls-area">
    <div class="search-container">
        <input type="text" id="search-input" placeholder="Search garden..." autocomplete="off">
    </div>
    <div id="calendar-wrapper">
        <div id="calendar-header">
            <button id="prev-month">&lt;</button>
            <span id="current-month-label"></span>
            <button id="next-month">&gt;</button>
        </div>
        <div id="calendar-grid"></div>
    </div>
</div>

<div class="tabs">
    <button class="tab-button active" data-tab="all">All</button>
    <button class="tab-button" data-tab="essays">Essays</button>
    <button class="tab-button" data-tab="engineering">Engineering</button>
    <button class="tab-button" data-tab="reflections">Reflections</button>
    <button class="tab-button" data-tab="journals">Journal</button>
</div>

<div class="post-list-container">
    <div class="post-list">
        <!-- Essays -->
        {% for post in site.essays %}
        <div class="post-item reveal" style="transition-delay: {{ forloop.index0 | times: 50 | plus: 100 }}ms;"
            data-category="essays" data-date="{{ post.date | date: '%Y-%m-%d' }}">
            <span class="post-meta">
                {% if post.status == 'seed' %}<span class="status status-seed">Seed</span>{% elsif post.status == 'bud'
                %}<span class="status status-bud">Bud</span>{% elsif post.status == 'evergreen' %}<span
                    class="status status-evergreen">Evergreen</span>{% endif %}
                {{ post.date | date: "%b %d" }}
            </span>
            <a href="{{ post.url }}">{{ post.title }}</a>
            <span class="category-label" data-tab="essays">Essay</span>
        </div>
        {% endfor %}

        <!-- Engineering -->
        {% for post in site.engineering %}
        <div class="post-item reveal" style="transition-delay: {{ forloop.index0 | times: 50 | plus: 100 }}ms;"
            data-category="engineering" data-date="{{ post.date | date: '%Y-%m-%d' }}">
            <span class="post-meta">
                {% if post.status == 'seed' %}<span class="status status-seed">Seed</span>{% elsif post.status == 'bud'
                %}<span class="status status-bud">Bud</span>{% elsif post.status == 'evergreen' %}<span
                    class="status status-evergreen">Evergreen</span>{% endif %}
                {{ post.date | date: "%b %d" }}
            </span>
            <a href="{{ post.url }}">{{ post.title }}</a>
            <span class="category-label" data-tab="engineering">Engineering</span>
        </div>
        {% endfor %}

        <!-- Reflections -->
        {% for post in site.reflections %}
        <div class="post-item reveal" style="transition-delay: {{ forloop.index0 | times: 50 | plus: 100 }}ms;"
            data-category="reflections" data-date="{{ post.date | date: '%Y-%m-%d' }}">
            <span class="post-meta">
                {% if post.status == 'seed' %}<span class="status status-seed">Seed</span>{% elsif post.status == 'bud'
                %}<span class="status status-bud">Bud</span>{% elsif post.status == 'evergreen' %}<span
                    class="status status-evergreen">Evergreen</span>{% endif %}
                {{ post.date | date: "%b %d" }}
            </span>
            <a href="{{ post.url }}">{{ post.title }}</a>
            <span class="category-label" data-tab="reflections">Reflection</span>
        </div>
        {% endfor %}

        <!-- Journals -->
        {% for post in site.journals %}
        <div class="post-item reveal" style="transition-delay: {{ forloop.index0 | times: 50 | plus: 100 }}ms;"
            data-category="journals" data-date="{{ post.date | date: '%Y-%m-%d' }}">
            <span class="post-meta">
                {% if post.status == 'seed' %}<span class="status status-seed">Seed</span>{% elsif post.status == 'bud'
                %}<span class="status status-bud">Bud</span>{% elsif post.status == 'evergreen' %}<span
                    class="status status-evergreen">Evergreen</span>{% endif %}
                {{ post.date | date: "%b %d" }}
            </span>
            <a href="{{ post.url }}">{{ post.title }}</a>
            <span class="category-label" data-tab="journals">Journal</span>
        </div>
        {% endfor %}
    </div>
</div>

<script>
    document.addEventListener('DOMContentLoaded', () => {
        // Elements
        const tabs = document.querySelectorAll('.tab-button');
        const posts = document.querySelectorAll('.post-item');
        const labels = document.querySelectorAll('.category-label');
        const searchInput = document.getElementById('search-input');
        const calendarGrid = document.getElementById('calendar-grid');
        const monthLabel = document.getElementById('current-month-label');
        const prevBtn = document.getElementById('prev-month');
        const nextBtn = document.getElementById('next-month');

        // State
        let currentFilter = {
            category: 'all',
            search: '',
            date: null
        };

        let currentDate = new Date();

        // --- Core Filtering Logic ---
        function applyFilters() {
            // Update Tab UI
            tabs.forEach(t => t.classList.remove('active'));
            const activeTab = document.querySelector(`.tab-button[data-tab="${currentFilter.category}"]`);
            if (activeTab) activeTab.classList.add('active');

            posts.forEach(post => {
                const category = post.getAttribute('data-category');
                const date = post.getAttribute('data-date');
                const text = post.innerText.toLowerCase();
                const label = post.querySelector('.category-label');

                // Checks
                const matchesCategory = currentFilter.category === 'all' || currentFilter.category === category;
                const matchesSearch = text.includes(currentFilter.search.toLowerCase());
                const matchesDate = currentFilter.date === null || currentFilter.date === date;

                if (matchesCategory && matchesSearch && matchesDate) {
                    post.style.display = 'flex';
                    // Show label only if in 'all' view AND not filtered by explicit other search
                    if (currentFilter.category === 'all') {
                        if (label) label.style.display = 'inline-block';
                    } else {
                        if (label) label.style.display = 'none';
                    }
                } else {
                    post.style.display = 'none';
                }
            });

            // Re-render calendar to show selection state
            renderCalendar(currentDate);
        }

        // --- Event Listeners ---

        // Tabs
        tabs.forEach(tab => {
            tab.addEventListener('click', () => {
                currentFilter.category = tab.getAttribute('data-tab');
                currentFilter.date = null; // Clear date filter when switching tabs? Or keep? Let's clear for UX clarity.
                applyFilters();
            });
        });

        labels.forEach(label => {
            label.addEventListener('click', (e) => {
                e.stopPropagation();
                currentFilter.category = label.getAttribute('data-tab');
                applyFilters();
            });
        });

        // Search
        searchInput.addEventListener('input', (e) => {
            currentFilter.search = e.target.value;
            applyFilters();
        });

        // --- Calendar Logic ---
        function getPostDates() {
            const dates = new Set();
            posts.forEach(p => {
                const date = p.getAttribute('data-date');
                if (date && date !== '') dates.add(date);
            });
            return dates;
        }

        function renderCalendar(date) {
            calendarGrid.innerHTML = '';
            const year = date.getFullYear();
            const month = date.getMonth();

            const firstDay = new Date(year, month, 1);
            const lastDay = new Date(year, month + 1, 0);
            const daysInMonth = lastDay.getDate();
            const startingDay = firstDay.getDay(); // 0 is Sunday

            monthLabel.textContent = date.toLocaleDateString('default', { month: 'long', year: 'numeric' });

            const postDates = getPostDates();

            // Empty slots
            for (let i = 0; i < startingDay; i++) {
                const empty = document.createElement('div');
                empty.className = 'calendar-day empty';
                calendarGrid.appendChild(empty);
            }

            // Days
            for (let i = 1; i <= daysInMonth; i++) {
                const dayDiv = document.createElement('div');
                dayDiv.className = 'calendar-day';
                dayDiv.textContent = i;

                // Format YYYY-MM-DD
                const dateString = `${year}-${String(month + 1).padStart(2, '0')}-${String(i).padStart(2, '0')}`;

                if (postDates.has(dateString)) {
                    const dot = document.createElement('span');
                    dot.className = 'red-dot';
                    dayDiv.appendChild(dot);
                    dayDiv.classList.add('has-post');

                    dayDiv.addEventListener('click', () => {
                        if (currentFilter.date === dateString) {
                            currentFilter.date = null; // Toggle off
                        } else {
                            currentFilter.date = dateString;
                        }
                        applyFilters();
                    });
                }

                if (currentFilter.date === dateString) {
                    dayDiv.classList.add('selected-day');
                }

                calendarGrid.appendChild(dayDiv);
            }
        }

        prevBtn.addEventListener('click', () => {
            currentDate.setMonth(currentDate.getMonth() - 1);
            renderCalendar(currentDate);
        });

        nextBtn.addEventListener('click', () => {
            currentDate.setMonth(currentDate.getMonth() + 1);
            renderCalendar(currentDate);
        });

        // Initialize
        renderCalendar(currentDate);
    });
</script>