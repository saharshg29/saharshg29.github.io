---
layout: default
---

<section class="page-header garden-header reveal">
    <div class="header-text">
        <h1>Digital Garden</h1>
        <p class="page-subtitle">Essays, engineering logs, and reflections.</p>

        <!-- Desktop Controls (hidden on mobile) -->
        <div class="garden-controls desktop-only">
            <div class="search-box">
                <input type="text" id="search-input-desktop" class="search-input-sync" placeholder="Search garden..."
                    autocomplete="off">
            </div>
            <div class="garden-tabs">
                <button class="tab-button active" data-tab="all">All</button>
                <button class="tab-button" data-tab="essays">Essays</button>
                <button class="tab-button" data-tab="engineering">Engineering</button>
                <button class="tab-button" data-tab="reflections">Reflections</button>
                <button class="tab-button" data-tab="journals">Journal</button>
            </div>
        </div>

        <!-- Mobile Search (Visible on mobile only) -->
        <div class="search-box mobile-only" style="margin-top: 1.5rem;">
            <input type="text" id="search-input-mobile" class="search-input-sync" placeholder="Search garden..."
                autocomplete="off">
        </div>
    </div>

    <!-- Desktop Calendar (hidden on mobile) -->
    <div id="calendar-wrapper" class="desktop-only">
        <div id="calendar-header">
            <button id="prev-month">&lt;</button>
            <span id="current-month-label"></span>
            <button id="next-month">&gt;</button>
        </div>
        <div id="calendar-grid"></div>
    </div>
</section>

<!-- Mobile FAB (Floating Action Button) -->
<button id="filter-fab" class="mobile-only" aria-label="Open Filters">
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" stroke="currentColor" stroke-width="2"
        stroke-linecap="round" stroke-linejoin="round">
        <polygon points="22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3"></polygon>
    </svg>
</button>

<!-- Mobile Bottom Sheet Backdrop -->
<div id="filter-backdrop" class="mobile-only"></div>

<!-- Mobile Bottom Sheet -->
<div id="filter-sheet" class="mobile-only">
    <div class="sheet-header">
        <span>Filters</span>
        <button id="close-sheet" aria-label="Close Filters">&times;</button>
    </div>
    <div class="sheet-content">
        <!-- Search is now in the main header -->
        <div class="sheet-tabs">
            <button class="tab-button active" data-tab="all">All</button>
            <button class="tab-button" data-tab="essays">Essays</button>
            <button class="tab-button" data-tab="engineering">Engineering</button>
            <button class="tab-button" data-tab="reflections">Reflections</button>
            <button class="tab-button" data-tab="journals">Journal</button>
        </div>
        <div id="calendar-wrapper-mobile">
            <div id="calendar-header-mobile">
                <button id="prev-month-mobile">&lt;</button>
                <span id="current-month-label-mobile"></span>
                <button id="next-month-mobile">&gt;</button>
            </div>
            <div id="calendar-grid-mobile"></div>
        </div>
    </div>
</div>

<div class="post-list-container">
    <div class="post-list">
        <div id="empty-state" style="display: none;">
            <p>No posts found matching your criteria. Try adjusting your search or filters.</p>
        </div>
        <!-- Essays -->
        {% for post in site.essays %}
        <div class="post-item reveal" style="transition-delay: {{ forloop.index0 | times: 50 | plus: 100 }}ms;"
            data-category="essays" data-date="{{ post.date | date: '%Y-%m-%d' }}">
            <span class="post-meta">
                {% if post.status == 'seed' %}<span class="status status-seed">Seed</span>{% elsif post.status == 'bud'
                %}<span class="status status-bud">Bud</span>{% elsif post.status == 'evergreen' %}<span
                    class="status status-evergreen">Evergreen</span>{% endif %}
                {{ post.date | date: "%b %d" }}
            </span>
            <a href="{{ post.url }}">{{ post.title }}</a>
            <span class="category-label" data-tab="essays">Essay</span>
        </div>
        {% endfor %}

        <!-- Engineering -->
        {% for post in site.engineering %}
        <div class="post-item reveal" style="transition-delay: {{ forloop.index0 | times: 50 | plus: 100 }}ms;"
            data-category="engineering" data-date="{{ post.date | date: '%Y-%m-%d' }}">
            <span class="post-meta">
                {% if post.status == 'seed' %}<span class="status status-seed">Seed</span>{% elsif post.status == 'bud'
                %}<span class="status status-bud">Bud</span>{% elsif post.status == 'evergreen' %}<span
                    class="status status-evergreen">Evergreen</span>{% endif %}
                {{ post.date | date: "%b %d" }}
            </span>
            <a href="{{ post.url }}">{{ post.title }}</a>
            <span class="category-label" data-tab="engineering">Engineering</span>
        </div>
        {% endfor %}

        <!-- Reflections -->
        {% for post in site.reflections %}
        <div class="post-item reveal" style="transition-delay: {{ forloop.index0 | times: 50 | plus: 100 }}ms;"
            data-category="reflections" data-date="{{ post.date | date: '%Y-%m-%d' }}">
            <span class="post-meta">
                {% if post.status == 'seed' %}<span class="status status-seed">Seed</span>{% elsif post.status == 'bud'
                %}<span class="status status-bud">Bud</span>{% elsif post.status == 'evergreen' %}<span
                    class="status status-evergreen">Evergreen</span>{% endif %}
                {{ post.date | date: "%b %d" }}
            </span>
            <a href="{{ post.url }}">{{ post.title }}</a>
            <span class="category-label" data-tab="reflections">Reflection</span>
        </div>
        {% endfor %}

        <!-- Journals -->
        {% for post in site.journals %}
        <div class="post-item reveal" style="transition-delay: {{ forloop.index0 | times: 50 | plus: 100 }}ms;"
            data-category="journals" data-date="{{ post.date | date: '%Y-%m-%d' }}">
            <span class="post-meta">
                {% if post.status == 'seed' %}<span class="status status-seed">Seed</span>{% elsif post.status == 'bud'
                %}<span class="status status-bud">Bud</span>{% elsif post.status == 'evergreen' %}<span
                    class="status status-evergreen">Evergreen</span>{% endif %}
                {{ post.date | date: "%b %d" }}
            </span>
            <a href="{{ post.url }}">{{ post.title }}</a>
            <span class="category-label" data-tab="journals">Journal</span>
        </div>
        {% endfor %}
    </div>
</div>

<script>
    document.addEventListener('DOMContentLoaded', () => {
        // Elements - All Tabs (both desktop and mobile)
        const tabs = document.querySelectorAll('.tab-button');
        const posts = document.querySelectorAll('.post-item');
        const labels = document.querySelectorAll('.category-label');

        // Desktop Elements
        const searchInputDesktop = document.getElementById('search-input-desktop');
        const calendarGrid = document.getElementById('calendar-grid');
        const monthLabel = document.getElementById('current-month-label');
        const prevBtn = document.getElementById('prev-month');
        const nextBtn = document.getElementById('next-month');

        // Mobile Elements
        const searchInputMobile = document.getElementById('search-input-mobile');
        const calendarGridMobile = document.getElementById('calendar-grid-mobile');
        const monthLabelMobile = document.getElementById('current-month-label-mobile');
        const prevBtnMobile = document.getElementById('prev-month-mobile');
        const nextBtnMobile = document.getElementById('next-month-mobile');

        // Mobile Sheet Controls
        const filterFab = document.getElementById('filter-fab');
        const filterBackdrop = document.getElementById('filter-backdrop');
        const filterSheet = document.getElementById('filter-sheet');
        const closeSheetBtn = document.getElementById('close-sheet');

        // State
        let currentFilter = {
            category: 'all',
            search: '',
            date: null
        };

        let currentDate = new Date();

        // --- Bottom Sheet Toggle ---
        function openSheet() {
            filterBackdrop.classList.add('active');
            filterSheet.classList.add('active');
            document.body.style.overflow = 'hidden';
        }

        function closeSheet() {
            filterBackdrop.classList.remove('active');
            filterSheet.classList.remove('active');
            document.body.style.overflow = '';
        }

        if (filterFab) filterFab.addEventListener('click', openSheet);
        if (closeSheetBtn) closeSheetBtn.addEventListener('click', closeSheet);
        if (filterBackdrop) filterBackdrop.addEventListener('click', closeSheet);

        // --- Core Filtering Logic ---
        function applyFilters() {
            // Update Tab UI
            tabs.forEach(t => t.classList.remove('active'));
            document.querySelectorAll(`.tab-button[data-tab="${currentFilter.category}"]`).forEach(t => t.classList.add('active'));

            let visibleCount = 0;
            posts.forEach(post => {
                const category = post.getAttribute('data-category');
                const date = post.getAttribute('data-date');
                const text = post.innerText.toLowerCase();
                const label = post.querySelector('.category-label');

                const matchesCategory = currentFilter.category === 'all' || currentFilter.category === category;
                const matchesSearch = text.includes(currentFilter.search.toLowerCase());
                const matchesDate = currentFilter.date === null || currentFilter.date === date;

                if (matchesCategory && matchesSearch && matchesDate) {
                    post.style.display = 'flex';
                    visibleCount++;
                    if (label) label.style.display = currentFilter.category === 'all' ? 'inline-block' : 'none';
                } else {
                    post.style.display = 'none';
                }
            });

            // Handle Empty State
            const emptyState = document.getElementById('empty-state');
            if (emptyState) {
                emptyState.style.display = visibleCount === 0 ? 'block' : 'none';
            }

            // Re-render calendars
            renderCalendar(currentDate, calendarGrid, monthLabel);
            renderCalendar(currentDate, calendarGridMobile, monthLabelMobile);
        }

        // --- Event Listeners ---
        // Tabs (both desktop and mobile)
        tabs.forEach(tab => {
            tab.addEventListener('click', () => {
                currentFilter.category = tab.getAttribute('data-tab');
                currentFilter.date = null;
                applyFilters();
            });
        });

        labels.forEach(label => {
            label.addEventListener('click', (e) => {
                e.stopPropagation();
                currentFilter.category = label.getAttribute('data-tab');
                applyFilters();
            });
        });

        // Search Sync (both inputs)
        function handleSearch(e) {
            currentFilter.search = e.target.value;
            // Sync both inputs
            if (searchInputDesktop) searchInputDesktop.value = currentFilter.search;
            if (searchInputMobile) searchInputMobile.value = currentFilter.search;
            applyFilters();
        }

        if (searchInputDesktop) searchInputDesktop.addEventListener('input', handleSearch);
        if (searchInputMobile) searchInputMobile.addEventListener('input', handleSearch);

        // --- Calendar Logic ---
        function getPostDates() {
            const dates = new Set();
            posts.forEach(p => {
                const date = p.getAttribute('data-date');
                if (date && date !== '') dates.add(date);
            });
            return dates;
        }

        function renderCalendar(date, gridEl, labelEl) {
            if (!gridEl || !labelEl) return;
            gridEl.innerHTML = '';
            const year = date.getFullYear();
            const month = date.getMonth();

            const firstDay = new Date(year, month, 1);
            const lastDay = new Date(year, month + 1, 0);
            const daysInMonth = lastDay.getDate();
            const startingDay = firstDay.getDay();

            labelEl.textContent = date.toLocaleDateString('default', { month: 'long', year: 'numeric' });

            const postDates = getPostDates();

            // Empty slots
            for (let i = 0; i < startingDay; i++) {
                const empty = document.createElement('div');
                empty.className = 'calendar-day empty';
                gridEl.appendChild(empty);
            }

            // Days
            for (let i = 1; i <= daysInMonth; i++) {
                const dayDiv = document.createElement('div');
                dayDiv.className = 'calendar-day';
                dayDiv.textContent = i;

                const dateString = `${year}-${String(month + 1).padStart(2, '0')}-${String(i).padStart(2, '0')}`;

                if (postDates.has(dateString)) {
                    const dot = document.createElement('span');
                    dot.className = 'red-dot';
                    dayDiv.appendChild(dot);
                    dayDiv.classList.add('has-post');

                    dayDiv.addEventListener('click', () => {
                        currentFilter.date = currentFilter.date === dateString ? null : dateString;
                        applyFilters();
                    });
                }

                if (currentFilter.date === dateString) {
                    dayDiv.classList.add('selected-day');
                }

                gridEl.appendChild(dayDiv);
            }
        }

        // Month Navigation (Desktop)
        if (prevBtn) prevBtn.addEventListener('click', () => {
            currentDate.setMonth(currentDate.getMonth() - 1);
            renderCalendar(currentDate, calendarGrid, monthLabel);
            renderCalendar(currentDate, calendarGridMobile, monthLabelMobile);
        });

        if (nextBtn) nextBtn.addEventListener('click', () => {
            currentDate.setMonth(currentDate.getMonth() + 1);
            renderCalendar(currentDate, calendarGrid, monthLabel);
            renderCalendar(currentDate, calendarGridMobile, monthLabelMobile);
        });

        // Month Navigation (Mobile)
        if (prevBtnMobile) prevBtnMobile.addEventListener('click', () => {
            currentDate.setMonth(currentDate.getMonth() - 1);
            renderCalendar(currentDate, calendarGrid, monthLabel);
            renderCalendar(currentDate, calendarGridMobile, monthLabelMobile);
        });

        if (nextBtnMobile) nextBtnMobile.addEventListener('click', () => {
            currentDate.setMonth(currentDate.getMonth() + 1);
            renderCalendar(currentDate, calendarGrid, monthLabel);
            renderCalendar(currentDate, calendarGridMobile, monthLabelMobile);
        });

        // Initialize
        renderCalendar(currentDate, calendarGrid, monthLabel);
        renderCalendar(currentDate, calendarGridMobile, monthLabelMobile);
    });
</script>