<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    {% seo %}
    <link rel="stylesheet" href="{{ '/assets/css/style.css' | relative_url }}">
    <link rel="icon" type="image/x-icon" href="/favicon.ico">
    {% if site.google_analytics %}
    <script async src="https://www.googletagmanager.com/gtag/js?id={{ site.google_analytics }}"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag() { dataLayer.push(arguments); }
        gtag('js', new Date());
        gtag('config', '{{ site.google_analytics }}');
    </script>
    {% endif %}
</head>

<body>
    <header class="site-header">
        <nav class="nav-container">
            <a href="/" class="nav-logo">{{ site.title }}</a>
            <div class="nav-links">
                <a href="/" class="nav-link">Home</a>
                <a href="/projects" class="nav-link">Projects</a>
                <a href="/experience" class="nav-link">Experience</a>
                <a href="/blogs" class="nav-link">Blogs</a>
                <a href="/now" class="nav-link">Now</a>
            </div>
        </nav>
    </header>
    <main class="main-content">
        {{ content }}
    </main>
    <footer class="site-footer">
        <p>© {{ "now" | date: "%Y" }} Saharsh Gupta — Built with intention.</p>
        <p style="font-size: 0.8rem; margin-top: 0.5rem; opacity: 0.5;">Press <kbd
                style="border: 1px solid var(--border); padding: 2px 4px; border-radius: 4px;">Cmd</kbd> + <kbd
                style="border: 1px solid var(--border); padding: 2px 4px; border-radius: 4px;">K</kbd> to search</p>
    </footer>

    <!-- Search Overlay -->
    <div id="search-overlay">
        <div class="search-modal">
            <div class="search-modal-header">
                <input type="text" id="global-search-input" class="search-modal-input"
                    placeholder="Type to search everything..." autocomplete="off">
            </div>
            <div id="global-search-results" class="search-results">
                <!-- Dynamic results -->
            </div>
        </div>
    </div>

    <script>
        // Command+K Search
        const overlay = document.getElementById('search-overlay');
        const searchInput = document.getElementById('global-search-input');
        const resultsContainer = document.getElementById('global-search-results');

        document.addEventListener('keydown', (e) => {
            if ((e.metaKey || e.ctrlKey) && e.key === 'k') {
                e.preventDefault();
                overlay.style.display = 'flex';
                searchInput.focus();
            }
            if (e.key === 'Escape') {
                overlay.style.display = 'none';
            }
        });

        overlay.addEventListener('click', (e) => {
            if (e.target === overlay) overlay.style.display = 'none';
        });

        // Simple Search Logic (Pages & Featured)
        const searchableItems = [
            { title: 'Home', url: '/', meta: 'Landing page' },
            { title: 'Projects', url: '/projects', meta: 'Work showcase' },
            { title: 'Experience', url: '/experience', meta: 'Career & Education' },
            { title: 'Blogs', url: '/blogs', meta: 'Technical writing' },
            { title: 'Now', url: '/now', meta: 'Current status' },
            { title: 'Vidhi AI', url: '/projects', meta: 'Legal RAG system' },
            { title: 'Turing.com', url: '/experience', meta: 'LLM Engineering role' }
        ];

        searchInput.addEventListener('input', (e) => {
            const query = e.target.value.toLowerCase();
            resultsContainer.innerHTML = '';
            if (!query) return;

            const filtered = searchableItems.filter(item =>
                item.title.toLowerCase().includes(query) ||
                item.meta.toLowerCase().includes(query)
            );

            filtered.forEach(item => {
                const div = document.createElement('a');
                div.href = item.url;
                div.className = 'search-result-item';
                div.innerHTML = `
                    <span class="search-result-title">${item.title}</span>
                    <span class="search-result-meta">${item.meta}</span>
                `;
                resultsContainer.appendChild(div);
            });
        });

        // --- MAGNETIC BUTTONS ---
        const magneticBtns = document.querySelectorAll('.nav-link, .hero-link, .tab-button, .project-card, .cta-link');

        magneticBtns.forEach(btn => {
            btn.addEventListener('mousemove', (e) => {
                const rect = btn.getBoundingClientRect();
                const x = e.clientX - rect.left - rect.width / 2;
                const y = e.clientY - rect.top - rect.height / 2;

                btn.style.transform = `translate(${x * 0.15}px, ${y * 0.15}px)`;
            });

            btn.addEventListener('mouseleave', () => {
                btn.style.transform = 'translate(0, 0)';
            });
        });

        // --- STAGGERED REVEALS (Fallback for dynamic content) ---
        const observer = new IntersectionObserver((entries) => {
            entries.forEach(entry => {
                if (entry.isIntersecting) {
                    entry.target.classList.add('visible');
                    observer.unobserve(entry.target);
                }
            });
        }, { threshold: 0.1 });

        document.querySelectorAll('.reveal').forEach(el => observer.observe(el));
    </script>
</body>

</html>